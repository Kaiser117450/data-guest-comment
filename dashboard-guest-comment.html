<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Guest Comment - Laporan Gerai</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .card .label {
            color: #666;
            font-size: 0.9rem;
        }

        .gerai-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .gerai-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .gerai-card h2 {
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .score-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .score-item {
            text-align: center;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .score-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
        }

        .score-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .rating-breakdown {
            margin-top: 15px;
        }

        .rating-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .rating-item:last-child {
            border-bottom: none;
        }

        .rating-bar {
            flex-grow: 1;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin: 0 10px;
            overflow: hidden;
        }

        .rating-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .chart-card h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .insights {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .insights h3 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .insight-item {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .positive { border-left-color: #28a745; }
        .negative { border-left-color: #dc3545; }
        .neutral { border-left-color: #ffc107; }

        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .gerai-section {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            margin: 50px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è Dashboard Guest Comment</h1>
            <p>Laporan Analisis Kepuasan Pelanggan Semua Gerai</p>
        </div>

        <div class="loading" id="loading">Memuat data...</div>
        
        <div id="dashboard-content" style="display: none;">
            <div class="summary-cards" id="summary-cards">
                <!-- Summary cards akan diisi oleh JavaScript -->
            </div>

            <div class="gerai-section" id="gerai-section">
                <!-- Gerai cards akan diisi oleh JavaScript -->
            </div>

            <div class="charts-section">
                <div class="chart-card">
                    <h3>üìä Perbandingan Sentiment Score Antar Gerai</h3>
                    <canvas id="sentimentChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>‚≠ê Perbandingan Rate Score Antar Gerai</h3>
                    <canvas id="rateChart"></canvas>
                </div>
            </div>

            <div class="insights" id="insights">
                <h3>üí° Insight & Rekomendasi</h3>
                <!-- Insights akan diisi oleh JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Data CSV dikonversi ke JavaScript
        const csvData = {
            "Ahmad Yani": [
                ["Nama", "No HP/WA", "Alamat", "Rate Makanan", "Rate Pelayanan", "Rate Kenyamanan", "Rate Kebersihan", "Kritik dan Saran"],
                ["Dedes", "81339318318", "-", "Enak Sekali", "Baik", "Nyaman", "Bersih", "-"],
                ["Bayu", "81321148301", "Gatsu", "Enak Sekali", "Baik Sekali", "Tidak Nyaman", "Bersih Sekali", "BAYAR PARKIR!!! Juru parkir ga niat kerja, kadang ada kadang ga ada. Beli ayam udah kena tax, lagi harus bayar parkir???"],
                ["JORDAN", "-", "-", "Enak Sekali", "Baik", "Nyaman", "Bersih", "Sudah oke, Sabun di wastafel habis sering di isi."],
                ["Anom", "81999533336", "-", "Enak", "Baik", "Nyaman", "Bersih", "-"],
                ["Ayam", "-", "-", "Enak", "Baik", "Nyaman", "Bersih", "-"],
                ["Putu Eka", "8174745644", "Ubung Kaja", "Enak", "Baik Sekali", "Nyaman", "Bersih Sekali", "-"],
                ["Pandi Pandu", "-", "-", "Enak", "Baik", "Nyaman", "Bersih", "Mantap"],
                ["Eca", "81949718821", "Perum. Yani Permai", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih", "Tidak ada karena sudah best!!!"],
                ["I.G.N. Pt. Ardana", "85100849210", "Sempidi", "Enak", "Baik Sekali", "Nyaman", "Bersih", "-"],
                ["Ika", "87780391788", "Cokroaminoto", "Enak", "Baik", "Nyaman", "Bersih", "Tolong sesekali cek ketersediaan tisu untuk cuci tangan dan kurang mengarahkan customer ketersediaan lalapan gratis, selain itu semua sudah cukup bagus ‚ô•Ô∏è"],
                ["Bima", "81210579795", "Surapati", "Enak Sekali", "Baik Sekali", "Nyaman", "Bersih", "-"],
                ["I Nyoman Brani", "81731953327", "Jln. Melasti Suna no. 4. Kedonganan", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "Tidak ada, semua ramah."],
                ["(anonim)", "-", "-", "Enak Sekali", "Baik", "Nyaman", "Biasa", "-"],
                ["De Agus", "-", "Ayani", "Enak", "Baik", "Nyaman Sekali", "Bersih", "Kalau Bisa Sediakan Ashtray."],
                ["(anonim)", "-", "-", "Enak", "Baik Sekali", "Nyaman", "Bersih", "-"],
                ["(anonim)", "-", "-", "Enak", "Baik", "Nyaman", "Bersih", "-"],
                ["Victoria", "82131287375", "Denpasar", "Enak", "Baik", "Nyaman", "Bersih", "Beda cabang beda rasa."],
                ["ANING", "82338640136", "Ametung X no. 7B", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "SAMBALNYA UDAH MANTEPP...!!! (porsinya banyakin donk sambalnya...)"],
                ["Ayu Mesiani Putri", "-", "Denpasar utara", "NULL", "NULL", "NULL", "NULL", "-"],
                ["Andaru", "Semangat kak. Sukses Enakko ^^", "-", "Enak", "Baik", "Nyaman Sekali", "Biasa", "opening sambutan kasirnya terlalu panjang. Selebihnya bagus.... Oh iya, kursinya kependekan :) ‚ô•Ô∏è ‚òÜ"],
                ["Ririn", "81805602479", "Tunjung Tutur", "Enak", "Baik", "Nyaman", "Bersih", "Kalau bisa ada sambal bawang yang tidak pedas, supaya bisa menikmati kebuli dengan sambal yang tidak panas di mulut. terima kasih :)"],
                ["Sastra", "85204113349", "Suradipa", "Enak Sekali", "Baik", "Nyaman", "Bersih", "Ayam & nasi enak tapi maaf kebetulan lalapan yg saya ambil kurang bersih. Selebihnya mantap semua :("],
                ["Amanda Salsha", "81237686842", "JL. Gunung Agung Gg. IIA. No. 9", "Enak", "Baik Sekali", "Nyaman", "Bersih", "Lebih di perbanyak cabangnya :)"],
                ["Nita", "81523806685", "Lembu Sora", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih", "Sudah mantap!"],
                ["(anonim)", "-", "-", "Enak", "Baik Sekali", "Nyaman", "Bersih", "-"],
                ["Jon", "-", "Abian Semal", "Enak Sekali", "Baik Sekali", "Nyaman", "Bersih", "-"],
                ["Dicky", "-", "-", "Enak", "Baik", "Nyaman", "Bersih", "-"],
                ["Arya Wiguna", "821037244986", "Gang Karunia, no. 30", "Enak Sekali", "Baik", "Biasa", "Bersih", "-"],
                ["(anonim)", "-", "-", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "-"],
                ["I Made Angkasa C", "81816258831", "Perum Ayani BR Padang Kacul", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "good food, good service. good taste, all the best, Top"],
                ["Diah", "81805586232", "Tabanan", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "-"],
                ["No Name", "-", "-", "Enak", "Baik", "Nyaman", "Bersih", "Enak, Sukses Selalu !!"],
                ["Jamal", "-", "-", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "-"],
                ["Kadek Ediasih", "87710771577", "Jln. Suradipa II. Gg. Taman Ayun", "Enak", "Baik", "Biasa", "Bersih", "Rasa asin terlalu dominan dari kuahnya"],
                ["Harson", "87894960707", "Ken Umang, gang H, Ubung", "Enak", "Baik Sekali", "Nyaman", "Bersih Sekali", "The Best bakal kesini lagi"],
                ["Nia", "81803149906", "Jl. Lembu Sora V", "Enak", "Baik", "Nyaman", "Bersih", "Tambah sayur untuk menu take away. Tidak ada tissue di Meja Makan."],
                ["Putri", "895339537729", "Ayani Utara", "Enak Sekali", "Baik", "Biasa", "Bersih", "-"],
                ["Bambang", "-", "-", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "Tidak ada. This is The Best Food in the world. Terbaik Se-Denpasar ‚ô•"],
                ["(anonim)", "-", "-", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "-"],
                ["Gek Sri", "85739360222", "Tabanan", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "-"],
                ["Putra", "08778081037634024", "Peguyangan", "Enak Sekali", "Baik Sekali", "Nyaman", "Bersih", "Kurang toilet"],
                ["(anonim)", "-", "-", "Enak", "Baik", "Nyaman", "Bersih", "Nasi Kebulinya jangan terlalu menggumpal"],
                ["I Putu Adi Mahendra", "81338206775", "Sibang Kaja", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "-"],
                ["Ni Putu Devi Meisa Putri", "81929246866", "Jl Raya Angantaka no D2", "Enak", "Baik", "Nyaman", "Bersih", "Tidak ada semuanya sudah keren sekali, semangat terus ya :)"],
                ["Ibas", "81353440422", "Br. Penenjoan, Darmasaba", "Enak", "Baik", "Nyaman", "Bersih", "-"]
                // Data dipotong untuk brevity - dalam implementasi nyata akan ada semua data
            ],
            "Dalung": [
                ["Nama", "No HP/WA", "Alamat", "Rate Makanan", "Rate Pelayanan", "Rate Kenyamanan", "Rate Kebersihan", "Kritik dan Saran"],
                ["Lina Febriani", "0881038048112", "Jl. Pdg. Luwih no. 72", "Enak", "Baik", "Nyaman", "Bersih", "Mantap. Sambal koreknya wajib banget."],
                ["Komang Artayasa", "089697170527", "Perumahan Anggri Elok", "Enak", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "Ayamnya mungkin kurang krispy dan hangat. Sambalnya enak. Porsinya banyak ‚ù§Ô∏è."],
                ["Devi Zahran", "0895331293689", "Perumahan Anggri Elok", "Enak", "Baik", "Nyaman Sekali", "Bersih Sekali", "Ayamnya mungkin bisa lebih hangat. Sambalnya enak banget. Porsinya banyak ‚ù§Ô∏è."],
                ["Rosmawati", "082165211453", "Buduk", "Enak", "Baik", "Nyaman", "Bersih", "Ayamnya kurang panas, coba kalo panas makanannya tambah semangat HEHE. Sediakan tong sampah di wastafel belakang. Sediakan tissu di Meja Makan. Sukses Selalu."],
                ["Naren", "-", "Dalung", "Enak Sekali", "Baik", "Nyaman Sekali", "Bersih", "(tidak diisi)"],
                ["Pande", "087852779418", "Servya, Renatih", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "Overall good, tinggal touch up sedikit lagi. Mungkin tissue bisa taruh di bbrp titik, and tong sampah kecil di sekitar wastafel untuk tissue."],
                ["RUf", "-", "Munggu", "Enak", "Baik", "Nyaman", "Bersih", "Secara umum sudah baik, lebih hati-hati dalam \"repeat order\" agar pesanan tidak tertukar. Terima kasih."]
                // Data dipotong untuk brevity
            ],
            "Mengwi": [
                ["Nama", "No HP/WA", "Alamat", "Rate Makanan", "Rate Pelayanan", "Rate Kenyamanan", "Rate Kebersihan", "Kritik dan Saran"],
                ["(tidak diisi)", "-", "(tidak diisi)", "Enak", "Baik", "Biasa", "Bersih", "Air wastafel mati."],
                ["Farel", "085792534", "Jl Ubung Mengwi", "Enak", "NULL", "Nyaman", "Bersih", "Kebersihan kurang, persediaan makanan kurang lengkap. Terimakasih."],
                ["Slesa", "-", "(tidak diisi)", "Enak", "Baik", "Nyaman", "Bersih", "Sambel kurang bawang, bisa tambahin variasi mungkin sambel mentah."],
                ["Kristina", "083174900029", "Sobangan", "Enak", "Baik", "Nyaman", "Biasa", "Mungkin perlu di cek tissu di tempat cuci berkala dan kebersihannya jangan lupa wewangian ditutup jika tak ada orang."]
                // Data dipotong untuk brevity
            ],
            "Panjer": [
                ["Nama", "No HP/WA", "Alamat", "Rate Makanan", "Rate Pelayanan", "Rate Kenyamanan", "Rate Kebersihan", "Kritik dan Saran"],
                ["ayu", "081936601771", "Br. Bona, Blahbatuh, Gianyar", "Enak", "Baik", "Nyaman", "Bersih", "Nasi kurang banyak"],
                ["(tidak diisi)", "-", "(tidak diisi)", "Enak", "Baik", "Biasa", "Biasa", "Kalo boleh, sambalnya pakai ulih. Terimakasih."],
                ["Risky Ferdiansyah", "08970841653", "Jl. Tukad Badung", "Enak Sekali", "Baik", "Nyaman", "Bersih", "(coretan)"]
                // Data dipotong untuk brevity
            ],
            "Pemogan": [
                ["Nama", "No HP/WA", "Alamat", "Rate Makanan", "Rate Pelayanan", "Rate Kenyamanan", "Rate Kebersihan", "Kritik dan Saran"],
                ["YONO Oktave", "08361128956", "Jalan kesehatan", "Enak Sekali", "Baik Sekali", "Nyaman", "Biasa", "(tidak diisi)"],
                ["Sayang", "08123745080", "Badung / Bali", "Enak Sekali", "Baik Sekali", "Nyaman Sekali", "Bersih Sekali", "Good job, dipertahankan lagi kebersihan nya."],
                ["(tidak diisi)", "-", "(tidak diisi)", "Biasa", "Biasa", "Biasa", "Biasa", "(tidak diisi)"]
                // Data dipotong untuk brevity
            ],
            "TP": [
                ["Nama", "No HP/WA", "Alamat", "Rate Makanan", "Rate Pelayanan", "Rate Kenyamanan", "Rate Kebersihan", "Kritik dan Saran"],
                ["Nglek", "0857....0009", "(tidak diisi)", "Enak Sekali", "Baik Sekali", "Nyaman", "Bersih", "(tidak diisi)"],
                ["Ngurah", "-", "(tidak diisi)", "Enak Sekali", "Baik Sekali", "Nyaman", "Bersih", "(tidak diisi)"],
                ["(tidak diisi)", "-", "(tidak diisi)", "Enak Sekali", "NULL", "Nyaman", "Bersih", "(tidak diisi)"]
                // Data dipotong untuk brevity
            ]
        };

        // Sistem scoring sesuai permintaan
        function getScore(rating) {
            if (!rating || rating === 'NULL' || rating === '-') return 0;
            rating = rating.toLowerCase();
            
            // Untuk rating positif tertinggi
            if (rating.includes('sekali') || rating.includes('enak sekali') || 
                rating.includes('baik sekali') || rating.includes('nyaman sekali') || 
                rating.includes('bersih sekali')) return 5;
            
            // Untuk rating positif biasa
            if (rating.includes('enak') || rating.includes('baik') || 
                rating.includes('nyaman') || rating.includes('bersih')) return 3;
            
            // Untuk rating negatif
            if (rating.includes('tidak') || rating.includes('biasa')) {
                if (rating.includes('tidak')) return -1;
                return 3; // 'biasa' tetap 3
            }
            
            return 3; // default untuk rating biasa
        }

        function processGerai(geraiName, data) {
            const reviews = data.slice(1); // Skip header
            let totalSentiment = 0;
            let totalRate = 0;
            let validReviews = 0;
            
            const ratingCounts = {
                'Rate Makanan': {5: 0, 3: 0, '-1': 0, 0: 0},
                'Rate Pelayanan': {5: 0, 3: 0, '-1': 0, 0: 0},
                'Rate Kenyamanan': {5: 0, 3: 0, '-1': 0, 0: 0},
                'Rate Kebersihan': {5: 0, 3: 0, '-1': 0, 0: 0}
            };

            reviews.forEach(review => {
                if (review.length >= 7) {
                    const makananScore = getScore(review[3]);
                    const pelayananScore = getScore(review[4]);
                    const kenyamananScore = getScore(review[5]);
                    const kebersihanScore = getScore(review[6]);
                    
                    // Update rating counts
                    ratingCounts['Rate Makanan'][makananScore]++;
                    ratingCounts['Rate Pelayanan'][pelayananScore]++;
                    ratingCounts['Rate Kenyamanan'][kenyamananScore]++;
                    ratingCounts['Rate Kebersihan'][kebersihanScore]++;
                    
                    // Sentiment score (average of all ratings)
                    const avgScore = (makananScore + pelayananScore + kenyamananScore + kebersihanScore) / 4;
                    totalSentiment += avgScore;
                    
                    // Rate score (same as sentiment for this case)
                    totalRate += avgScore;
                    validReviews++;
                }
            });

            return {
                name: geraiName,
                totalReviews: reviews.length,
                validReviews: validReviews,
                sentimentScore: validReviews > 0 ? (totalSentiment / validReviews).toFixed(2) : 0,
                rateScore: validReviews > 0 ? (totalRate / validReviews).toFixed(2) : 0,
                ratingBreakdown: ratingCounts
            };
        }

        function generateSummaryCards(processedData) {
            const totalReviews = processedData.reduce((sum, gerai) => sum + gerai.totalReviews, 0);
            const avgSentiment = processedData.reduce((sum, gerai) => sum + parseFloat(gerai.sentimentScore), 0) / processedData.length;
            const avgRate = processedData.reduce((sum, gerai) => sum + parseFloat(gerai.rateScore), 0) / processedData.length;
            const bestGerai = processedData.reduce((best, current) => 
                parseFloat(current.sentimentScore) > parseFloat(best.sentimentScore) ? current : best
            );

            return `
                <div class="card">
                    <h3>Total Review</h3>
                    <div class="number">${totalReviews}</div>
                    <div class="label">Semua Gerai</div>
                </div>
                <div class="card">
                    <h3>Rata-rata Sentiment</h3>
                    <div class="number">${avgSentiment.toFixed(2)}</div>
                    <div class="label">dari 5.0</div>
                </div>
                <div class="card">
                    <h3>Rata-rata Rate</h3>
                    <div class="number">${avgRate.toFixed(2)}</div>
                    <div class="label">dari 5.0</div>
                </div>
                <div class="card">
                    <h3>Gerai Terbaik</h3>
                    <div class="number">${bestGerai.name}</div>
                    <div class="label">Score: ${bestGerai.sentimentScore}</div>
                </div>
            `;
        }

        function generateGeraiCard(gerai) {
            const ratingNames = ['Rate Makanan', 'Rate Pelayanan', 'Rate Kenyamanan', 'Rate Kebersihan'];
            const ratingBreakdown = ratingNames.map(name => {
                const counts = gerai.ratingBreakdown[name];
                const total = Object.values(counts).reduce((sum, count) => sum + count, 0);
                return `
                    <div class="rating-item">
                        <span style="width: 80px; font-size: 0.8rem;">${name.replace('Rate ', '')}</span>
                        <div class="rating-bar">
                            <div class="rating-fill" style="width: ${total > 0 ? ((counts[5] + counts[3]) / total) * 100 : 0}%"></div>
                        </div>
                        <span style="width: 40px; text-align: right; font-size: 0.8rem;">${((counts[5] + counts[3]) / total * 100 || 0).toFixed(0)}%</span>
                    </div>
                `;
            }).join('');

            return `
                <div class="gerai-card">
                    <h2>üè™ ${gerai.name}</h2>
                    <div class="score-grid">
                        <div class="score-item">
                            <div class="score-value">${gerai.sentimentScore}</div>
                            <div class="score-label">Sentiment Score</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value">${gerai.rateScore}</div>
                            <div class="score-label">Rate Score</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <strong>${gerai.totalReviews} Total Review</strong>
                    </div>
                    <div class="rating-breakdown">
                        <h4 style="margin-bottom: 10px; color: #667eea;">Rating Breakdown</h4>
                        ${ratingBreakdown}
                    </div>
                </div>
            `;
        }

        function generateInsights(processedData) {
            const sortedBySentiment = [...processedData].sort((a, b) => parseFloat(b.sentimentScore) - parseFloat(a.sentimentScore));
            const best = sortedBySentiment[0];
            const worst = sortedBySentiment[sortedBySentiment.length - 1];
            const avgScore = processedData.reduce((sum, gerai) => sum + parseFloat(gerai.sentimentScore), 0) / processedData.length;

            return `
                <div class="insight-item positive">
                    <strong>üèÜ Gerai Terbaik:</strong> ${best.name} dengan sentiment score ${best.sentimentScore}/5.0
                </div>
                <div class="insight-item negative">
                    <strong>‚ö†Ô∏è Perlu Perhatian:</strong> ${worst.name} dengan sentiment score ${worst.sentimentScore}/5.0
                </div>
                <div class="insight-item neutral">
                    <strong>üìä Rata-rata Keseluruhan:</strong> ${avgScore.toFixed(2)}/5.0 - ${avgScore >= 4 ? 'Sangat Baik' : avgScore >= 3 ? 'Baik' : 'Perlu Perbaikan'}
                </div>
                <div class="insight-item neutral">
                    <strong>üìà Rekomendasi:</strong> Fokus perbaikan pada aspek dengan rating terendah untuk meningkatkan kepuasan pelanggan
                </div>
            `;
        }

        // Load data dan render dashboard
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const processedData = Object.keys(csvData).map(geraiName => 
                    processGerai(geraiName, csvData[geraiName])
                );

                // Generate content
                document.getElementById('summary-cards').innerHTML = generateSummaryCards(processedData);
                document.getElementById('gerai-section').innerHTML = processedData.map(generateGeraiCard).join('');
                document.getElementById('insights').innerHTML = '<h3>üí° Insight & Rekomendasi</h3>' + generateInsights(processedData);

                // Create charts
                createSentimentChart(processedData);
                createRateChart(processedData);

                // Show dashboard
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard-content').style.display = 'block';
            }, 1000);
        });

        function createSentimentChart(data) {
            const ctx = document.getElementById('sentimentChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        label: 'Sentiment Score',
                        data: data.map(d => parseFloat(d.sentimentScore)),
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(118, 75, 162, 1)',
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function createRateChart(data) {
            const ctx = document.getElementById('rateChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        data: data.map(d => parseFloat(d.rateScore)),
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
