
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guest Comment Dashboard Age Bali</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <style>
        @font-face {
            font-family: 'Digitalt';
            src: url('Digitalt.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Rubik';
            src: url('Rubik-VariableFont_wght.ttf') format('truetype');
            font-weight: 100 900;
            font-style: normal;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #111827;
            --muted: #6b7280;
            --radius: 12px;
        }
        * { box-sizing: border-box; margin:0;padding:0;font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); line-height: 1.5; }
        .container { max-width: 1200px; margin: auto; padding: 24px; }
        h1 { font-family: 'Digitalt', 'Inter', sans-serif; font-weight: 800; font-size: 2rem; }
        .header { text-align:center; margin-bottom:32px; }
        .header p { font-family: 'Rubik', 'Inter', sans-serif; color: var(--muted); margin-top:4px; }
        .grid { display:grid; gap:20px; }
        .cards { grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); margin-bottom:32px; }
        .card { background: var(--card-bg); border-radius: var(--radius); padding:20px; box-shadow: 0 1px 3px rgba(0,0,0,.08); text-align:center; }
        .card h3 { font-size:.95rem; font-weight:600; color:var(--muted); }
        .card .big { font-size:1.8rem; font-weight:800; margin-top:6px; }
        .chart-wrap { background: var(--card-bg); border-radius: var(--radius); padding:20px; }
        .chart-grid { grid-template-columns: 1fr 1fr; }
        table { width:100%; border-collapse: collapse; }
        th,td { padding:10px 12px; border-bottom:1px solid #e5e7eb; }
        th { text-align:left; background:#f1f3f7; font-size:.85rem; font-weight:600; }
        td { font-size:.85rem; }
        .table-wrap { background: var(--card-bg); border-radius: var(--radius); padding:20px; overflow:auto; }
        .tag { background:var(--bg); border:1px solid #e5e7eb; padding:2px 6px; border-radius:6px; font-size:.75rem; color:var(--muted); }
        /* Responsive table for mobile */
        .mobile-table { display: none; }
        .desktop-table { display: block; }
        @media(max-width:768px){ 
            .chart-grid{grid-template-columns:1fr;} 
            .desktop-table { display: none; }
            .mobile-table { display: block; }
            .mobile-comment-card {
                background: var(--card-bg);
                border: 1px solid #e5e7eb;
                border-radius: var(--radius);
                padding: 16px;
                margin-bottom: 12px;
                box-shadow: 0 1px 3px rgba(0,0,0,.05);
            }
            .mobile-comment-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 12px;
                flex-wrap: wrap;
                gap: 8px;
            }
            .mobile-comment-name {
                font-weight: 600;
                color: var(--primary);
            }
            .mobile-comment-gerai {
                font-size: 0.8rem;
                background: #dc2626;
                color: white;
                padding: 2px 8px;
                border-radius: 12px;
            }
            .mobile-comment-score {
                font-size: 1.1rem;
                font-weight: 700;
                color: white;
                text-align: center;
                background: #dc2626;
                padding: 4px 8px;
                border-radius: 8px;
                min-width: 50px;
            }
            .mobile-comment-ratings {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                margin-bottom: 12px;
                font-size: 0.85rem;
            }
            .mobile-rating-item {
                display: flex;
                justify-content: space-between;
                padding: 4px 8px;
                background: var(--bg);
                border-radius: 6px;
            }
            .mobile-rating-label {
                color: var(--muted);
                font-weight: 500;
            }
            .mobile-comment-text {
                background: #f8fafc;
                padding: 12px;
                border-radius: 8px;
                font-size: 0.9rem;
                line-height: 1.4;
                color: var(--text);
                border-left: 3px solid #dc2626;
            }
            .mobile-comment-address {
                font-size: 0.8rem;
                color: var(--muted);
                margin-top: 8px;
            }
        }
            /* Toolbar */
        .toolbar {display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px;}
        .toolbar select,.toolbar input{padding:8px 10px;border:1px solid #e5e7eb;border-radius:8px;background:#fff;font-size:.85rem;}
        .toolbar label{font-size:.8rem;color:var(--muted);margin-right:4px;}
        .muted { color: var(--muted); }
        /* Tooltip for customer names */
        .customer-name {
            position: relative;
            cursor: pointer;
            color: var(--primary);
            font-weight: 500;
            transition: color 0.2s ease;
        }
        .customer-name:hover {
            color: #4f46e5;
        }
        .customer-name .tooltip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 1000;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            pointer-events: none;
        }
        .customer-name .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-top-color: rgba(0,0,0,0.9);
        }
        .customer-name:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        /* Easter Egg Styles */
        .easter-egg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ff0000 0%, #ff9900 100%);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 9999;
            opacity: 0;
            scale: 0.5;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            color: white;
        }
        .easter-egg.show {
            opacity: 1;
            scale: 1;
        }
        .easter-egg img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.3);
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }
        .easter-egg h3 {
            font-family: 'Rubik', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .easter-egg p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        .easter-egg button {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .easter-egg button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .logo-click {
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        .logo-click:active {
            transform: scale(0.95);
        }
        @media(max-width:480px){
            h1{font-size:1.5rem}
            .card .big{font-size:1.4rem}
            th,td{padding:8px}
            .container { padding: 16px; }
            /* Footer responsive */
            .footer-grid {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
                text-align: center;
            }
            .footer-grid > div:first-child {
                justify-content: center;
            }
            .mobile-comment-ratings {
                grid-template-columns: 1fr !important;
            }
            .easter-egg {
                margin: 20px;
                padding: 20px;
                width: calc(100% - 40px);
                max-width: 300px;
            }
            .easter-egg img {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Dashboard Guest Comment</h1>
        <p>Laporan Ringkasan Nilai Setiap Gerai</p>
    </div>

    <!-- Summary Cards -->
    <div class="grid cards" id="card-container"></div>

    <!-- Chart Section -->
    <div class="grid chart-grid" style="margin-bottom:32px;">
        <div class="chart-wrap">
            <h3 style="margin-bottom:12px;font-weight:600;">Rata-rata Skor per Gerai</h3>
            <canvas id="avgChart"></canvas>
        </div>
        <div class="chart-wrap">
            <h3 style="margin-bottom:12px;font-weight:600;">Distribusi Review per Gerai</h3>
            <canvas id="countChart"></canvas>
        </div>
    </div>

    

    <!-- Table All Comments -->
    <div class="table-wrap">
        <!-- toolbar -->
        <div class="toolbar">
            <label for="selGerai">Gerai</label>
            <select id="filterGerai">
                <option value="all">Semua Gerai</option>
            </select>
            <label for="selCategory">Kategori</label>
            <select id="selCategory">
                <option value="all">Semua</option>
                <option value="positive">Paling Positif</option>
                <option value="critical">Paling Kritis</option>
            </select>
            <input type="text" id="txtSearch" placeholder="Cari komentar atau nama..." style="flex:1;" />
        </div>
        <h3 style="margin-bottom:12px;font-weight:600;">Daftar Komentar</h3>
        
        <!-- Desktop Table -->
        <div class="desktop-table">
            <table id="tblReviews">
                <thead>
                    <tr>
                        <th>Gerai</th>
                        <th>Nama</th>
                        <th>Alamat</th>
                        <th>Rate Makanan</th>
                        <th>Pelayanan</th>
                        <th>Kenyamanan</th>
                        <th>Kebersihan</th>
                        <th>Skor&nbsp;Rata2</th>
                        <th>Komentar</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <!-- Mobile Cards -->
        <div class="mobile-table" id="mobileComments"></div>
    </div>
</div>

<!-- Footer -->
<footer style="background: #dc2626; color: white; margin-top: 40px; padding: 32px 0;">
    <div class="container">
        <div class="footer-grid" style="display: grid; grid-template-columns: 1fr 2fr; gap: 32px; align-items: center;">
            <!-- Logo dan Scoring Info -->
            <div style="display: flex; align-items: center; gap: 20px;">
                <div id="logo-container" class="logo-click" style="width: 60px; height: 60px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: #dc2626;">
                    <img src="logo.png" alt="Logo" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <div>
                    <h4 style="margin-bottom: 8px; font-weight: 600;">Sistem Penilaian</h4>
                    <div style="font-size: 0.85rem; opacity: 0.9; line-height: 1.4;">
                        <div>• Enak Sekali / Baik Sekali = <strong>5 poin</strong></div>
                        <div>• Enak / Baik / Nyaman / Bersih = <strong>4 poin</strong></div>
                        <div>• Biasa = <strong>3 poin</strong></div>
                        <div>• Tidak Enak / Tidak Baik = <strong>-1 poin</strong></div>
                        <div>• Kosong / NULL = <strong>0 poin</strong></div>
                    </div>
                </div>
            </div>
            

            <div>
                <p style="font-size: 0.9rem; opacity: 0.9; line-height: 1.6;">
                    Kami harap dengan hasil guest comment ini, kami dapat meningkatkan kualitas pelayanan dan produk kami.
                </p>
            </div>
        </div>
        


        <!-- Dataset Link (subtle) -->
        <div style="text-align: center; margin-top: 12px; font-size: 0.75rem; opacity: 0.7;">
            <a href="#" id="dataset-link" style="color: rgba(255,255,255,0.8); text-decoration: none; border-bottom: 1px dotted rgba(255,255,255,0.5);">📁 Dataset Sumber (Google Drive)</a>
        </div>

        <!-- Copyright -->
        <div style="text-align: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 0.8rem; opacity: 0.8;">
            2025 Ayam Guling Enakko Bali. All rights reserved.
        </div>
    </div>
</footer>

<!-- Easter Egg Modal -->
<div id="easter-egg" class="easter-egg">
    <img src="AdorableCutieChiikawa.webp" alt="Chiikawa" />
    <h3>Kamu baru aja nemuin aku?</h3>
    <p>Website ini dibuat oleh Akmal</p>
    <p><strong>Digital marketing of AGE Bali</strong> ✨</p>
    <button onclick="closeEasterEgg()">Close</button>
</div>

<script src="csv_data.js"></script>
<script>
const SCORE_MAP = { high:5, medium:3, low:-1, null:0 };
// Dataset link - ganti URL ini dengan link Google Drive Anda
const DATASET_URL = "https://drive.google.com/drive/folders/1r4DkGkCWqQgXD6pBIU5Mq42S-dlLL72l?usp=sharing";

function mapValue(v){ if(!v||v==='NULL'||v==='-'||v==='(tidak diisi)'||v==='(coretan)')return 0; const t=v.toLowerCase(); if(t.includes('sekali'))return 5; if(t.includes('tidak'))return -1; if(t.includes('enak')||t.includes('baik')||t.includes('nyaman')||t.includes('bersih'))return 4; if(t.includes('biasa'))return 3; return 0; }
function process(){
  const aspectTotals = {makanan:[],pelayanan:[],kenyamanan:[],kebersihan:[]};
  const summary=[]; const rowsAll=[];
  Object.entries(csvData).forEach(([gerai,data])=>{
     let total=0,count=0;
     let sumM=0,sumP=0,sumK=0,sumB=0;
     for(let i=1;i<data.length;i++){
        const r=data[i]; if(r.length<7)continue;
        const m=mapValue(r[3]); const p=mapValue(r[4]); const k=mapValue(r[5]); const b=mapValue(r[6]);
        sumM+=m; sumP+=p; sumK+=k; sumB+=b;
        const avg=(m+p+k+b)/4; total+=avg; count++;
        rowsAll.push({gerai,nama:r[0]||'(anonim)',alamat:r[2]||'-',makanan:r[3]||'-',pelayanan:r[4]||'-',kenyamanan:r[5]||'-',kebersihan:r[6]||'-',avg:avg.toFixed(2),komentar:r[7]||''});
     }
     summary.push({gerai,count,avg:count?total/count:0,makanan:count?sumM/count:0,pelayanan:count?sumP/count:0,kenyamanan:count?sumK/count:0,kebersihan:count?sumB/count:0});
  });
  summary.sort((a,b)=>b.avg-a.avg);
  return {summary,rowsAll};
}
function renderCards(data){const cont=document.getElementById('card-container');const totalRev=data.summary.reduce((s,g)=>s+g.count,0);const best=data.summary[0];const second=data.summary[1]||{};const third=data.summary[2]||{};
  cont.innerHTML=`
    <div class="card"><h3>Total Review</h3><div class="big">${totalRev}</div></div>
    <div class="card"><h3>🏆 Gerai #1</h3><div class="big">👑 ${best.gerai}</div><div class="tag">Skor ${best.avg.toFixed(2)}</div></div>
    ${second.gerai?`<div class="card"><h3>Peringkat #2</h3><div class="big">${second.gerai}</div><div class="tag">Skor ${second.avg.toFixed(2)}</div></div>`:''}
    ${third.gerai?`<div class="card"><h3>Peringkat #3</h3><div class="big">${third.gerai}</div><div class="tag">Skor ${third.avg.toFixed(2)}</div></div>`:''}
  `;}

function charts(data){
  const labels=data.summary.map(g=>g.gerai);
  const ctx1=document.getElementById('avgChart').getContext('2d');
  new Chart(ctx1,{type:'bar',data:{labels,datasets:[
      {label:'Makanan',data:data.summary.map(g=>g.makanan.toFixed(2)),backgroundColor:'#6366f1'},
      {label:'Pelayanan',data:data.summary.map(g=>g.pelayanan.toFixed(2)),backgroundColor:'#34d399'},
      {label:'Kenyamanan',data:data.summary.map(g=>g.kenyamanan.toFixed(2)),backgroundColor:'#fbbf24'},
      {label:'Kebersihan',data:data.summary.map(g=>g.kebersihan.toFixed(2)),backgroundColor:'#f87171'}]},
      options:{responsive:true,scales:{y:{beginAtZero:true,max:5}}}});
  const ctx2=document.getElementById('countChart').getContext('2d');
  new Chart(ctx2,{type:'pie',data:{labels,datasets:[{data:data.summary.map(g=>g.count),backgroundColor:['#6366f1','#60a5fa','#34d399','#fbbf24','#f87171','#a78bfa']}]},options:{plugins:{legend:{position:'bottom'}}}});
}
function table(rows){
  try {
    // Desktop table
    const tbody=document.querySelector('#tblReviews tbody');
    if(!tbody) {
      console.error('Table body not found');
      return;
    }
    
    tbody.innerHTML=rows.map(r=>{
    // Find phone number from csvData
    let phoneNumber = '';
    Object.entries(csvData).forEach(([gerai,data])=>{
      if(gerai === r.gerai) {
        for(let i=1;i<data.length;i++){
          if(data[i][0] === r.nama) {
            phoneNumber = data[i][1] || '';
            break;
          }
        }
      }
    });
    
    const tooltipText = phoneNumber ? `📞 ${phoneNumber}` : '📞 Tidak ada nomor';
    
    return `<tr>
      <td>${r.gerai}</td>
      <td>
        <span class="customer-name">
          ${r.nama}
          <span class="tooltip">${tooltipText}</span>
        </span>
      </td>
      <td>${r.alamat}</td>
      <td>${r.makanan}</td>
      <td>${r.pelayanan}</td>
      <td>${r.kenyamanan}</td>
      <td>${r.kebersihan}</td>
      <td style="text-align:center;font-weight:600">${r.avg}</td>
      <td>${r.komentar}</td>
    </tr>`;
  }).join('');
  
  // Mobile cards
  const mobileContainer = document.getElementById('mobileComments');
  if(!mobileContainer) {
    console.error('Mobile container not found');
    return;
  }
  
  mobileContainer.innerHTML = rows.map(r => {
    // Find phone number from csvData
    let phoneNumber = '';
    Object.entries(csvData).forEach(([gerai,data])=>{
      if(gerai === r.gerai) {
        for(let i=1;i<data.length;i++){
          if(data[i][0] === r.nama) {
            phoneNumber = data[i][1] || '';
            break;
          }
        }
      }
    });
    
    const tooltipText = phoneNumber ? `📞 ${phoneNumber}` : '📞 Tidak ada nomor';
    
    return `
      <div class="mobile-comment-card">
        <div class="mobile-comment-header">
          <div>
            <div class="mobile-comment-name">
              <span class="customer-name">
                ${r.nama}
                <span class="tooltip">${tooltipText}</span>
              </span>
            </div>
            <div class="mobile-comment-gerai">${r.gerai}</div>
          </div>
          <div class="mobile-comment-score">${r.avg}</div>
        </div>
        
        <div class="mobile-comment-ratings">
          <div class="mobile-rating-item">
            <span class="mobile-rating-label">Makanan</span>
            <span>${r.makanan}</span>
          </div>
          <div class="mobile-rating-item">
            <span class="mobile-rating-label">Pelayanan</span>
            <span>${r.pelayanan}</span>
          </div>
          <div class="mobile-rating-item">
            <span class="mobile-rating-label">Kenyamanan</span>
            <span>${r.kenyamanan}</span>
          </div>
          <div class="mobile-rating-item">
            <span class="mobile-rating-label">Kebersihan</span>
            <span>${r.kebersihan}</span>
          </div>
        </div>
        
        ${r.komentar ? `<div class="mobile-comment-text">${r.komentar}</div>` : ''}
        
        <div class="mobile-comment-address">📍 ${r.alamat}</div>
      </div>
    `;
  }).join('');
  
  } catch(error) {
    console.error('Error in table function:', error);
  }
}
function applyFilters(rows){
  const geraiVal=document.getElementById('filterGerai').value;
  const cat=document.getElementById('selCategory').value;
  const q=document.getElementById('txtSearch').value.toLowerCase();
  return rows.filter(r=>{
      if(geraiVal!=='all' && r.gerai!==geraiVal) return false;
      const avg=parseFloat(r.avg);
      if(cat==='positive' && avg<4) return false;
      if(cat==='critical' && avg>2.5) return false;
      if(q && !(r.nama.toLowerCase().includes(q) || r.alamat.toLowerCase().includes(q) || r.komentar.toLowerCase().includes(q))) return false;
      return true;
  });
}
window.addEventListener('DOMContentLoaded',()=>{
  const data=process();
  // populate gerai options
  const sel=document.getElementById('filterGerai');
  data.summary.forEach(g=>{
      const opt=document.createElement('option');opt.value=g.gerai;opt.textContent=g.gerai;sel.appendChild(opt);
  });
  renderCards(data);charts(data);
  let currentRows=data.rowsAll;
  const refresh=()=>{table(applyFilters(currentRows));};
  refresh();
  ['filterGerai','selCategory','txtSearch'].forEach(id=>document.getElementById(id).addEventListener('input',refresh));
  
  // Debug: Check if data is loaded
  console.log('Data loaded:', data.rowsAll.length, 'rows');
  
  // Setup dataset link
  document.getElementById('dataset-link').href = DATASET_URL;
  
  // Easter Egg Logic
  let clickCount = 0;
  let clickTimer = null;
  
  document.getElementById('logo-container').addEventListener('click', function() {
    clickCount++;
    
    // Reset counter after 3 seconds of no clicks
    clearTimeout(clickTimer);
    clickTimer = setTimeout(() => {
      clickCount = 0;
    }, 3000);
    
    // Trigger easter egg after 7 clicks
    if (clickCount >= 7) {
      showEasterEgg();
      clickCount = 0;
    }
  });
});

function showEasterEgg() {
  const easterEgg = document.getElementById('easter-egg');
  easterEgg.classList.add('show');
}

function closeEasterEgg() {
  const easterEgg = document.getElementById('easter-egg');
  easterEgg.classList.remove('show');
}
</script>
</body>
</html>
